<app-base-page>
  <div class="p-4 sm:p-6 lg:p-8 max-w-screen-md mx-auto min-h-screen">
    <h2 class="text-2xl font-bold text-900 mb-4">Confirmação do Pedido</h2>

    <div class="mb-4">
      <div
        *ngFor="let item of cartItems"
        class="flex justify-content-between align-items-center py-2 border-bottom-1 border-gray-200"
      >
        <div class="text-sm text-800">
          {{ item.quantity }}x {{ item.name }}
        </div>
        <div class="text-sm font-medium text-900">
          {{ (item.price * item.quantity) | currency:'BRL':'symbol':'1.2-2' }}
        </div>
      </div>

      <div class="flex justify-content-between align-items-center mt-3 pt-3 border-top-1 border-gray-300">
        <span class="font-bold text-lg">Total</span>
        <span class="font-bold text-lg text-primary">
          {{ getTotal() | currency:'BRL':'symbol':'1.2-2' }}
        </span>
      </div>
    </div>
    <div class="mb-6">
      <h3 class="text-lg font-semibold mb-3">Forma de pagamento</h3>
      <div class="card flex justify-content-left">
        <form class="flex flex-column gap-3" [formGroup]="formGroup">
            <div *ngFor="let metodo of metodosPagamento" class="field-checkbox">
                <p-radioButton
                    [inputId]="metodo.tipo"
                    [value]="metodo.tipo"
                    formControlName="selectedCategory"
                    (click)="selecionarMetodo(metodo.tipo)"
                   />
                <label [for]="metodo.tipo" class="ml-2">
                    {{ metodo.nome }}
                </label>
                <i [class]="metodo.icone + ' text-blue-500 text-xl ml-2'"></i>
            </div>
        </form>
    </div>

    </div>

    <div *ngIf="selectedPayment === 'credito' || selectedPayment === 'debito'" class="mb-4">
      <h3 class="text-lg font-semibold mb-2">Cartões Salvos</h3>
      <div class="flex flex-column gap-3">
        <div
          *ngFor="let card of savedCards"
          class="surface-card border-round shadow-1 p-3 flex justify-content-between align-items-center"
        >
          <div class="text-sm text-800">
            Cartão final {{ card.lastDigits }} - {{ card.name }}
          </div>
          <p-button
            label="Usar"
            size="small"
            (click)="selectCard(card)"
            [outlined]="selectedCard?.id !== card.id"
            [class.p-button-primary]="selectedCard?.id === card.id"
          ></p-button>
        </div>

        <p-button
          label="Cadastrar novo cartão"
          icon="pi pi-plus"
          class="p-button-sm p-button-text"
        ></p-button>
      </div>
    </div>

    <div *ngIf="selectedPayment === 'pix'" class="mt-4 p-4 border rounded-lg bg-gray-50 text-center">
      <p class="mb-3 font-medium">Escaneie com seu app bancário</p>

      <img *ngIf="qrCodeDataUrl" [src]="qrCodeDataUrl" alt="QR Code Pix" class="mx-auto w-48 h-48" />

      <p class="mt-3 text-sm text-gray-600 break-words">
        {{ qrCodePixPayload }}
      </p>

      <button
        pButton
        type="button"
        label="Copiar código Pix"
        icon="pi pi-copy"
        class="mt-2"
        (click)="copiarCodigoPix()"
      ></button>
    </div>

    <div *ngIf="selectedPayment === 'boleto'" class="mt-4 border rounded-lg bg-gray-50">
      <h3 class="text-lg font-semibold mb-4">Dados para emissão do boleto</h3>

      <form class="grid gap-4">

        <div>
          <label for="nome" class="block text-sm font-medium mb-1">Nome completo</label>
          <input id="nome" name="nome" type="text" class="w-full border p-2 rounded" required />
        </div>

        <div>
          <label for="cpf" class="block text-sm font-medium mb-1">CPF</label>
          <input id="cpf" name="cpf" type="text" class="w-full border p-2 rounded" required />
        </div>

        <div>
          <label for="email" class="block text-sm font-medium mb-1">E-mail</label>
          <input id="email" name="email" type="email" class="w-full border p-2 rounded" required />
        </div>

        <button
          pButton
          type="submit"
          label="Gerar Boleto e Enviar"
          class="mt-2"
          (click)="enviarBoleto()"
        ></button>
      </form>

      <p *ngIf="boletoEnviado" class="mt-4 text-green-600">Boleto enviado com sucesso para {{ boleto.email }}.</p>
    </div>

    <div class="flex flex-column sm:flex-row justify-content-between gap-3 mt-5">
      <button
        pButton
        label="Cancelar"
        class="p-button-outlined p-button-danger"
      ></button>
      <button
        pButton
        label="Concluir Pedido"
        class="p-button-primary"
      ></button>
    </div>
  </div>
</app-base-page>
